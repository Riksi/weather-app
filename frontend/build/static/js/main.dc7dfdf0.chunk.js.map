{"version":3,"sources":["index.js"],"names":["window","onload","map","marker","latInput","document","getElementById","lonInput","near","clear","locations","neighbours","presentNearestIdx","init","neighboursOf","sendData","Streamlit","setComponentValue","state","getLatLng","lat","lng","presentNearest","circle","data","usaf","wban","getState","clearNear","forEach","n","removeLayer","style","display","roundString","x","Math","round","showPopup","elem","before","after","lon","content","undefined","bindPopup","openPopup","hidePopup","closePopup","changeMapState","latLng","setLatLng","update","panTo","changeMarker","latval","parseFloat","value","lonval","isNaN","onMapClick","e","latlng","console","log","inp","onfocus","classList","add","onblur","remove","onchange","onclick","l","idx","L","circleMarker","radius","addTo","stname","start","end","on","DomEvent","stopPropagation","circlelatLng","setStyle","color","push","fitBounds","events","addEventListener","RENDER_EVENT","detail","args","setView","tileLayer","maxZoom","attribution","initialise","abs","warn","setFrameHeight","setComponentReady"],"mappings":"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","file":"static/js/main.dc7dfdf0.chunk.js","sourcesContent":["import L from 'leaflet';\nimport { Streamlit, RenderData } from \"streamlit-component-lib\"\n    \n    window.onload = function(){\n        // Input elements\n        var latInput = document.getElementById(\"lat\");\n        var lonInput = document.getElementById(\"lon\");\n        var near = document.getElementById(\"near\");\n        var clear = document.getElementById(\"clear\");\n        var inputs = [latInput, lonInput];\n\n        // Map\n        var map;\n        var marker;\n        \n        // Neighbours\n        var locations = [];\n        var neighbours = [];\n        var presentNearestIdx = null;\n        var init = true;\n        var neighboursOf = null;\n        // var isFocused = false;\n\n        \n\n        inputs.forEach(inp => {\n\n            inp.onfocus = function(){\n                inp.classList.add('focused')\n            }\n            \n            inp.onblur = function() {\n                inp.classList.remove('focused')\n            }\n\n        })\n        \n\n        function getState(){\n            var state = {}\n            state['marker'] = {\n                'lat': marker.getLatLng().lat, \n                'lon': marker.getLatLng().lng\n            }\n            if (presentNearestIdx !== null){\n                var presentNearest = neighbours[presentNearestIdx];\n                state['ws'] = {\n                    'idx': presentNearestIdx,\n                    'lat': presentNearest.circle.getLatLng().lat, \n                    'lon': presentNearest.circle.getLatLng().lng,\n                    'usaf': presentNearest.data.usaf,\n                    'wban': presentNearest.data.wban\n                }\n            } else {\n                state['ws'] = null\n            }\n            state['for'] = neighboursOf\n            return state\n        }\n\n        function sendData(){\n            Streamlit.setComponentValue(getState())\n        }\n\n        function getLatLng(){\n            var latval = parseFloat(latInput.value);\n            var lonval = parseFloat(lonInput.value);\n\n            if (!(isNaN(latval) || isNaN(lonval))){\n                return [latval, lonval];\n            }\n            else{\n                return null\n            }\n        }\n\n        function clearNear(){\n            neighbours.forEach(function(n){\n                map.removeLayer(n.circle);\n            });\n            neighbours = [];\n            clear.style.display = \"none\";\n            presentNearestIdx = null;\n            neighboursOf = null;\n\n            // near.value = \"Find stations nearby\";\n        }\n        \n        function showNear(){\n            clearNear();\n\n            var latLng = marker.getLatLng()\n            console.log('Showing near', latLng.lat, latLng.lng)\n            \n\n            neighboursOf = {\"lat\": latLng.lat, \"lon\": latLng.lng};\n            \n            clear.style.display = \"inline-block\";\n            locations.forEach(\n                (l, idx)=>{\n                    var circle = L.circleMarker(\n                        [l['lat'], l['lon']],\n                        {radius: 12}\n                    ).addTo(map);\n                    var before =  `<strong>${l.stname}</strong>`\n                    before += `<br>USAF: ${l.usaf}, WBAN: ${l.wban}`\n                    var after = `Available dates: ${l.start} to ${l.end}`\n                    \n                    circle.on('mouseover', ()=>{\n                        showPopup(\n                            circle,\n                            before, after\n                        )\n                    })\n                    circle.on('mouseout', ()=>{\n                        hidePopup(circle)\n                    })\n                    circle.on(\n                        'click',\n                        (e)=>{\n                            L.DomEvent.stopPropagation(e);\n                            \n                            console.log('circle', latLng.lat, latLng.lng)\n                            var circlelatLng = circle.getLatLng();\n                            changeMapState([circlelatLng.lat, circlelatLng.lng])\n\n                            if(presentNearestIdx != idx){\n\n                                showPopup(\n                                    circle,\n                                    before, after\n                                )\n                                \n    \n                                latInput.value = circlelatLng.lat;\n                                lonInput.value = circlelatLng.lng;\n                                \n                                if(presentNearestIdx !== null){\n                                    neighbours[presentNearestIdx].circle.setStyle({color: '#3388ff'});\n                                }\n                                \n                                circle.setStyle({color: '#f03'});\n                                presentNearestIdx = idx;\n                            }\n                            else{\n                                circle.openPopup();\n                            }\n                            \n                            sendData();\n                        }\n                        \n                    )\n                    neighbours.push({\n                        circle: circle,\n                        data: l\n                    });\n                }\n            )\n            map.fitBounds(neighbours.map(function(n){return n.circle.getLatLng()}));\n        }\n\n        function roundString(x){\n            return (Math.round(x * 10**4) / 10**4) + \"\"\n        }\n\n        function showPopup(elem, before, after){\n            var lat = roundString(elem.getLatLng().lat);\n            var lon = roundString(elem.getLatLng().lng);\n            var content =  `Lat: ${lat}, Lon: ${lon}`\n            if (before !== undefined){\n                content = before + \"<br>\" + content;\n            }\n            if (after !== undefined){\n                content = content + \"<br>\" + after;\n            }\n            elem.bindPopup(content).openPopup();\n        }\n\n        function hidePopup(elem){\n            elem.closePopup();\n        }\n\n        function changeMapState(latLng){\n            marker.setLatLng(latLng).update();\n                map.panTo(latLng);\n                showPopup(marker);\n                // if (neighboursOf !== null){\n                //     near.value = \"Update\";\n                // }\n            \n        }   \n\n        function changeMarker() {\n            var latLng = getLatLng();\n\n            if (latLng !== null){\n                changeMapState(latLng);\n                sendData();\n            }\n        }\n\n        function onMapClick(e) {\n            var latval = e.latlng.lat;\n            var lonval = e.latlng.lng;\n\n            latInput.value = latval;\n            lonInput.value = lonval;\n            console.log('click', latval, lonval);\n\n            changeMapState([latval, lonval]);\n            sendData();\n        }\n\n        function initialise(lat, lon){\n            var latLng = [lat, lon];\n\n            // Map\n            map = L.map('map').setView(latLng, 10);\n            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\n                maxZoom: 19,\n                attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\n            }).addTo(map);\n            map.on('click',  onMapClick);\n\n            // Marker\n            marker = L.marker(latLng).addTo(map);\n\n            \n\n            marker.on('click', (e)=>{\n                    showPopup(marker);\n                    L.DomEvent.stopPropagation(e);\n                }\n            )\n            marker.on('mouseover', (e)=>{\n                    showPopup(marker);\n                }\n            )\n            marker.on('mouseout', (e)=>{\n                hidePopup(marker);\n            })\n            \n            \n            latInput.value = lat;\n            lonInput.value = lon;\n        }\n\n        latInput.onchange = changeMarker;\n        lonInput.onchange = changeMarker;\n        near.onclick = showNear;\n        clear.onclick = clearNear;\n\n        Streamlit.events.addEventListener(Streamlit.RENDER_EVENT, (e)=>{\n            var data = e.detail\n            locations = data.args['data'];\n            \n            \n            // Maintain compatibility with older versions of Streamlit that don't send\n            // a theme object.\n            // if (data.theme) {\n            //     // Use CSS vars to style our button border. Alternatively, the theme style\n            //     // is defined in the data.theme object.\n            //     const borderStyling = `1px solid var(${\n            //     isFocused ? \"--primary-color\" : \"gray\"\n            //     })`\n            //     inputs.forEach(\n            //         (inp)=>{\n            //             inp.style.border = borderStyling\n            //             inp.style.outline = borderStyling\n            //         }\n            //     )\n            // }\n            \n            // if init update lat and lon\n            // otherwise assert difference is small\n            if(init){\n                var lat = data.args['lat'];\n                var lon = data.args['lon'];\n                initialise(lat, lon);\n                init = false;\n                console.log('RENDER_EVENT:', lat, lon);\n            }\n            else{\n                var eps = 1e-6;\n                var latval = parseFloat(latInput.value);\n                var lonval = parseFloat(lonInput.value);\n                if (Math.abs(latval - data.args['lat']) > eps || Math.abs(lonval - data.args['lon']) > eps){\n                    console.warn('WARNING: lat and lon are not the same as the ones in the event', latval, lonval, data.args['lat'], data.args['lon']);\n                }\n                else{\n                    console.log('RENDER_EVENT: lat and lon are the same as the ones in the event');\n                }\n            }\n            Streamlit.setFrameHeight(1000);\n        })\n\n        Streamlit.setComponentReady();\n        Streamlit.setFrameHeight(1000);\n    }\n        \n"],"sourceRoot":""}